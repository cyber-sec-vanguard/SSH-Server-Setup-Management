# SSH Server Setup and Management
In this project, I will set up an SSH server, and manage it. I will do my best to document everything -unlike me other projects. Eventually, I will try to automate this setup and management, resulting in another DevSecOps project.\n

First things first, I will setup an SSH server on my virtual machine.'n

# Documentation
## Server Simple Configuration
We will play with the `ssh_config` file, located in `/etc/ssh`. Back it up: `cp sshd_config sshd_config,old`.\n
I won't get into all keywords, some are obvious, such as `Protocol 2`.\n
### Matches
The config file is global, and works for all users, until it finds a `Match` keyword. Once it encounters that key, it will verify whether the match is satisfied. If no, it skips to the next match, and reverify. If it doesn't match any, it exits the config file. If it matches one, everything that is listed bellow it will be applied, until it reaches the end of the file, or encounters another `Match`.\n
    You can match many things, including the username, the group, the IP address, or the three of them. If you want it to match one key with many values, separate the values with commas, like this\n
`Match User lotfi, ahmad, oussama`\n
    `PasswordAuthentication no`\n
    Matches can stack up. If one matches (say) the username, and the other matches the IP address, then that user will have the configuration from the two blocs.\n
`Match User lotfi`\n
    `X11Forwarding yes`\n
`Match Group hacker_man`\n
    `PasswordAuthentication yes`\n
If a user is guteshel, from the group hacker_man, then he can have X forwarding, and authenticate using his passwd.\n
You want to use this to control clients' behaviour, including intruders.\n
### Banner
Banners can serve as a legal notice for intruders. They are displayed before login.\n
    Alternatively, you may use Message Of The Day, or MOTD, a banner that is displayed post login.\n
`Banner         /etc/ssh/banner # Edit this file and enter the message you want.`\n
`PrintMotd      yes # yes | no.`\n
### Password Attempts
If you have to use passwords, control how this feature is used.\n
`LoginGraceTime 30s     # The pre-authentication timeout. You can use 'm' instead. It is set to 2m by default.`\n
`MaxAuthTries   3       # It is set to 6 by default.`\n
### Verify Login with DNS
It is good to make sshd check wether both the hostname and the IP address match using a DNS server. If the result is positive, sshd allows the connection. Otherwise, it denies it.\n
    It can be expensive to maintain a local DNS, and is vulnerable to DNS cach poisoning. Using the ISP's DNS is even more expensive. It may be better to maintain a local DNS and use it securily. But it may not be ideal to use a solution that does not scale, what if your company grows to have 400 different machine? How will you maintain the DNS?\n
`UseDNS yes`\n
### Logging
Select what type of logging you want. 'Auth' means authentication related logs. There are other options. One of them is USER records messages generated by the user apps or activities.\
`SysLogFacility  Auth`\
`LogLevel        INFO            # The log level. Some levels violate privacy. This one logs`\
`   # login and logoff problems.`\
### Ciphers and MACs
I really disliked the default ciphers. Ross Anderson stated in his book that many libraries and tools have unsafe defaults.
`Cipher  aes128-gcm@openssh.com, aes256-gcm@openssh.com, aes128-ctr, aes192-ctr, aes256-ctr, aes128-cbc, aes192-cbc, aes256-cbc`\n
`MACs    hmac-sha2-512, hmac-sha2-256, umac-128@openssh.com, umac-64@openssh.com # I did not study`\n
`   # study UMAC, IDK whther it is good.`
### Service Denial Countermeasures
We will use three things to counter them:\n
    1. Short timeout for unauthorized sessions. Discussed already.
    2. Throttelling password attempts. Discussed already.
    3. Random Early Drop. Discussed now.
When using RED, if a certain number of unauthorized connections are up (let's call it the Threshold), then all next connections will have a chance of getting rejection. As the number of connections grow, the chance of rejection grows. If it reaches a max limit, all new attemps will fail.\n
This gives the IT team a chance to log onto the SSH server and deals with the attack.\n
`MaxStratups     10:30:100       # LowerLimit : InitialRejectionChance : MaxLimit`\n
Veros: if there are more than ten unauthorized connections, start rejecting with a chance of 30%. If there are one hundred connection, reject all other connections.\n
### Restricting Access by User or Group
Groups == roles.\n
Clients may need to use a server, but they don't need SSH access. Use this feature to allow certain groups in, or deny certain groups from accessing. You can use AllowX and DenyX in two ways: allow everyone and block some, or block all but allow some. In the former, you use DenyUser and DenyGroup. In the latter, you use AllowUser and AllowGroup. These keys can take more than one value, separated by commas.\n
`AllowGroups    sec, devs, admins   # Allow only users that belong to one of these three groups`\n
It is best practice to use groups. Ideally, you wan't to lower the chances of failure. Groups help you lower them.\n
Additionally, consider using IP blocking plug-ins, or packet filters. Use these to create an MLS system.\n
Consider using a sandbox, like Linux's 'seccomp'.\n
### Loging in as root
This is not a good idea. If someone logs in as regular user and uses root powers, it will be logged. If a user logs in as root, nothing will be logged (according to the book, at least. It may have changed by now). This is undesirable, mostly.\n
`PermitRootLogin    no`\n
`PermitRootLogin    forced-commands-only   # Forbids scrips`\n
### Chrooting
When you create a chroot directory, configure ssh to log the user onto its `/` chroot directory, not its `/home/username/` chroot directory.\n
Match   User    username
ChrootDirectory /usr/prisonroot/home/username
Next, make sure that the username is in `/etc/passwd` chroot file. If not, add it.\n
Next, set the right perms for the `/home/username/` chroot dir.\n
This may be my favourite SSH feature.\n
## Configure Client
To connect to a different username than yours, use username@hostname, where username is the username you want to connect to, and hostname is the server's name. This works too for SFTP, and SCP. To make the changes permanent, note them down on ssh_config. The three programs read from this file.
### File management
#### SCP
For Secure Copy Protocol, or SCP, the syntax is `scp source:path/to/file destination:/patho/to/file`. the source can be a name or an IP address. If the destination is not specified, it will copy it into the user's home directory.
#### SFTP
The SSH File Transfer Protocol, or SFTP, is more flexible. It allows you to manage files. SFTP is not FTP over SSH or SSL. But their commands are identical. Use `put` to post, `get` to get, `reget` to resume getting after internet blackout, it won't check for integrity, though. Use `cd` for the host, and `lcd` for the client, the l is probably for local.
### Configure SCP and SFTP in ssh_config
The SCP must be on the system's default $PATH. If it is present, SCP is on.
OpenSSH comes with an SFTP server. The entry is sufficient to activate SFTP. You can set up a client to have no access but SFTP access, to allow them to copy files around. This is compatible with chroot. Such a user will only need two entries: `ForceCommand internal-sftp` and `AllowTcpForwarding no`. This will force the user -after a match- to use one command: sftp.
To stop them from copying files around, you must create a chroot with no files. They can still copy files to it though. There isn't any real way to totally block them.

## Client Configuration
### Static servers
Use the `Host` key to specify which hosts `ssh` connects to automatically. You can specify hostnames, or IP addresses, or both; one, or many. It connects to the first match.\n
`Host   ssh_server 192.168.1.1`\n
    You can configure it to expect domain names. This way, you only specify the hostname and it adds the domain name.\n
`CanonicalizeHostname   yes`\n
`CanonicalDomains       qsecurity.com`\n
    Use `Port` to specify the port.
### Jump Proxy Server
This server will be used as a proxy. Your client will connect to it and use it to connect to the SSH server. The intermediate server will onyl see your encrypted traffic, and alter it, but SSH will detect any fabrication or alteration.\n
`ProxyJump      proxy@domain-name.com`\n
### Set Source Address
If the local host has multiple IP addresses, you may want to set it to use only one address as its source. By default, it originates the connections from the primary address, which may not be desired.\n
`BindAddress    192.168.1.1`\n
### Strange Public Keys
You can configure `ssh` to not connect to a server if it does not recognize its public keys. This means that `ssh` must find the keys locally cashed. This makes sense in an environment where keys are distributed through a central distribution server.\n
`StrictHostKeyChecking  yes`\n
You can set it to `no`/`off`. In that case, it will ask the user whether he wants to accept the connection, or reject it. Ideally, if you do not want your system users to make mistakes, then do not allow them to.\n
You can set it to `accept-new`, which is the opposit of `yes`. This is not used by a rational man.\n
### Hash Host Names
If a acker gets into your client, you don't want it to know the hostnames of other machines. You should hash them.\n
`HashKnownHosts yes`\n
Hash the existing hostnames using `ssh-keygen -H`. Test it, then delete the known_hosts.old file. It is generated by that command, and contains the unhashed files.\n
`Use `ssh-keygen -R <hashed_hostname>   # Use this to remove a hashed hostname. It will delete the .old file too`\n
### Multiplexing
This allows you to start multiple SSH sessions over one TCP connection. Additional sessions should start quickly\
`ControlMaster  auto`\
`ControlPath    ~/.ssh/sockets/%u@%h:%p # Anyone with access to this direcyory will see that traffic. Use with caution`\
It will slow down your sessions. Additionally, X Forwarding doesn't work well.\
### Compression
It used to be useful. Now, it normally slows down. use `-C` flag to compress.\
## SSH Keys
Before I proceed to creating the SSH RSA, and ECDSA keys, I will read the RFC8017, FIPS 186-5, SP 800-57. You'll find them bellow.\
Create the keys, and comply with the standards. For short: at least 3072 bit key for RSA, and at least 256-bit key for ECDSA.\
Store the keys in the user's ~/.ssh/ directory, on his local host and on the SSH server. Set the right perms: 700 for the directory, and 600 for the keys.\
On the SSH server side, make sure that the server can find the keys in the right location, check the config file for `AuthorizedKeysFile`. Ensure that only the user can access that file and Kpubs. Store the Kpubs in one file called `authorized_keys`, use the `cat id_ecdsa.pub >> authorized_keys`, make sure to use double chevron and not a single chevron; a single chevron will erase the old data and replace it with the new one; double chevron will concatenate the new to the end of the file. You may want to use Match here, so that each user is directed to his own [chroot] folder.\
You should encrypt your private keys with a good passphrase. Use uppercase, lowercase, special symbols, and make it long eough so that the pp can't be brute-forced, nor guessed./
If you have problems, use `LogLevel DEBUG3` in the config file, and `journalctl ssh` on terminal to see the logs and locate the issue.\
Don't make the changes live until you test them and find them to be working. We've already covered how can you start another ssh service on another port. do so, and use it to test.\
You may want to allow certain services or users to use passwords while you solve some of their problems using a Match. It is exteremly unwise to allow it based on username. Know that the weakspot in your system is the user that is allowed to use passwords.\
### SSH Agent
You use it to store your decrypted key in the memory. Don't use it if you don't trust the root, or whomever is capable of reading memory. Don't suspend your machine while the agent is alive. Don't leave your machine unlocked.\
use `ssh-add /path/to/Kpriv`.\
Use `ssh-add -D` to destroy identities from the agent's memory, this way, if someone get's to use your laptop, they will need to enter the pp. Use `ssh-add -l` to list the identites.\
### Keys
You need to consider keys management. If a key --a machine-- is compromised, you need to remove its Kpub from your `authorized_keys` file ASAP. I may also create a simple script to make the operation quicket. You also needto consider cryptoperiods.\
Set this configurations:\
`ChallengeResponseAuthentication    no`\
`PasswordAuthentication             no`\
`PubkeyAuthentication               yes`\
### Agent forwarding
You use it to extend the trust to the SSH server and allow it to use decrypt your private key without any pp. This is useful in that it allows you to access certain services from it that you can't access from your localhost. That is considering Availability. But considering Confidentialiy and Integrity, I highly discourage this./
## X Forwarding
One good thing about the X protocol is that it allows you to display graphics on your localhost, while the program is running on a different machine. Don't use it with machines you don't trust, a compromised machine's user may be capable of accessing your machine as if it was you. X is not secure.\
Cross-site Forwarding may not be a very good idea due to latency. There are better alternatives to X though.\
In this protocol, the client is the machine that runs the code that generates the display, while the server shows the display.\
Install xauth and xterm on the SSH server, and set `X11Forwarding yes`. On the client, set `ForwardX11 yes`. This gives you the basics and is somewhat secure. If you want to enable all X features then --actually no, I won't tell you. This is insecure.\
Even better than this is to enable X Forwarding to certain SSh servers only, whether using Host keyword, or through CLI. To sue the latter, use `ssh -CX hostname`.\
## TCP Forwarding
You can run any insecure TCP protocol on a secure SSH service.\
TCP Forwarding can be used to evade security and break the policy. Personally, I dislike it. I may use it though :-).\
You'll need OpSec, and intrustion and extrusion detection. Refer to Richard Bejtlich's book on it, and Network Flow Analysis by this author.\
### Troubleshooting
A server should respond to a netcat request over a forwardded port the same way as a request over a non forwarded port. If not, then you probably have misconfigured port forwarding. Check your configuration and consult the journal.\
Know that this is but a tool. Some protocols don't work withit.\
### Local port forwarding
In local port forwarding, you will connect two different ports, from two different addresses. One of the ports is local, and the other is remote. Anything that is served through the remote port will arrive to you through your local port. To do this:\
`ssh -L localIP:localPort:remoteIP:remotePort servername`. In some cases, the remoteIP==localIP==127.0.0.1.\ 
Or in the config file:
`Host servername`\
`   LocalForward localIP:localPort remoteIP:remotePort`
### Remote forwarding
This is mainly used to evade a firewall. In this case, anyone that connects to the remote port will connect to your local port. You may use this to connect to your work station from home, or to your personal machine from work. This raises some security concerns. So long as your connection to the server remains open, anyone can connect to your machine.\
To use it, add -R flag, or replace LocalForward with RemoteForward.\
### Dynamic forwarding
You turn a port on your machine onto a SOCKS proxy server, and anything that is sent to it will be forwarded to the SSh server.\
`ssh -D localIP:localPort servername`\
or\
`DynamicForward host:port`\
Webbrowsers support SOCKS proxies, use them to test. Firstly, make sure that you can't access the internet from your localhost. Use dynamic forwarding. If you can access it now, then it's working.\
The address you select must be facing the service you're requesting or offering. If you're offering internet service, select the address that corresponds to the interface that is connected to the internet.\
You don't have much control over port forwarding. If partially allowed, users will find ways to get around. Deny it complitely.
`AllowTcpForwarding no`\
Or to yes, or to `local`, or to `remote`.\
`GatewayPorts` exists on both servers and clients. It controls local forwarding for clients , and remote forwarding for servers. Setting it to `yes` on clients means that ssh can listen on any local port. Setting it to `yes` on server means that anyone will bind to all port, which is stupid. Setting it to `clientspecified` on the server will allow the client to connect to what he chose.\
You can have more control through `PermitOpen hostname:port hostname:port ...` in sshd_config. everything else will be forbidden.\
You can set a `ExitOnForwardFailure` to `yes` on the client to tell it to drop the connection if the port forwarding fails.\
## KEeping connection alive
TCP and SSH connections are terminated after a while of IDLE. The way to keep it alive is to send some lightweight packets. OpenSSH does this by default using the TCProtocol, you can turn it in sshd_config off by:\
`TCPKeepAlive   no  # Why would you?`\
IT can also be done through OpenSSH, its keepalives are much more flexible than TCP's. It is also more lickely to hodl a session open even through a lengthy router reboot. OpenSSH uses TCP keepalives by default, not OpenSSh. You can configure the server and client to use them. For the server:\
`ClientAliveInterval    90  # not more than 120 seconds!`\
`ClientAliveCountMax    5   # Max missed keepalive packets before the server terminates the connection`\
As for the server:\
`ServerAliveInterval    90`\
`ServerAliveCountMax    4   # Same as server byt the client terminates the session, not connection.`\
The second setting is great. If the server or client goes down, the connection will also go down eventually. Otherwise, you may have many sshd services running in the void.\
## Key Distribution

### RFC 8017
All of this is regarding RSA, RSAES-OAEP, and RSASSA-PSS.\n
Quote: "A generally good cryptographic practice is to employ a given RSA key pair in only one scheme. This avoids the risk that vulnerability in one scheme may compromise the security of the other and may be essential to maintain provable security." They gave examples of using RSASSA-PSS with RSA-SSA-PKCS1-v1_5, and RSA-OEAP with RSAES-PKCS1-v1_5\n
Quote: "RSAES-OAEP is REQUIRED to be supported for new applications; RSAES-PKCS1-v1_5 is included only for compatibilitywith existing applications." I suppose this is down to the tool to use RSAES-OAEP, and support KCKS1-v1_5. The tool here is OpenSSH.\n
Quote: "Two signature schemes with appendix are specified in this document: RSASSA-PSS and RSASSA-PKCS1-v1_5. Although no attacks are known against RSASSA-PKCS1-v1_5, in the interest of increased robustness, RSASSA-PSS is REQUIRED in new applications." RSASSA-PKCS1-v1_5 is included only for compatibility.\n
Quote: "Typical salt lengths in octets are hLen (the length of the outputof the hash function Hash) and 0. In both cases, the security of RSASSA-PSS can be closely related to the hardness of inverting RSAVP1."\n
Done.\n
### FIPS 186-5
#### DSA
Quote: "Prior versions of this standard specified the DSA. This standard no longer approves the DSA for digital signature generation. However, the DSA may be used to verify signatures generated prior to the implementation date of this standard. See FIPS 186-4 [7] for the specifications for the DSA.\n
#### RSA
Quote: "An RSA digital signature key pair shall not be used for other purposes (e.g., key establishment)."\n
Quote: "This standard specifies the use of a modulus whose bit length is an even integer and greater than or equal to 2048 bits. Furthermore, this standard specifies that p and q be of the same bit length –namely, half the bit length of n. The maximum security strength of RSA schemes associated with the bit length of the modulus is specified in NIST SP 800-57, Part 1". They did not say that the two prime numbers be of equal, or fairly equal value.\n
This document refers a lot to SP 800-57, Part 1 :-). It mentioned Part 3 too.\n
Quote: "A CA should use a modulus whose length nlen is equal to or greater than the bit-length of every modulus used by its subscribers. For example, if the subscribers are using nlen = 2048, then the CA should use nlen ≥ 2048. SP 800-57, Parts 1 and 3, provide further information about comparable security strength guidance."\n
Quote: "Prime number generation seeds shall be kept secret or destroyed when the modulus n is computed." Otherwise, kept secret and protected.
#### ECDSA
Quote: "ECDSA keys shall not be used for any other purpose (e.g., key establishment)."\n
When it comes to key strength based on the key length, I see that one may need at least a 256 bit long ECDSA key, in order for him to achieve a 128-bit security strength. 128-bit in symmetric cryptography is good enough and is easy on the hardware.\n
Quote: "Normally, a CA should use a bit length of n whose assessed security strength is equal to or greater than the assessed security strength associated with the bit length of n used by its subscribers."\n
Quote: "Each key pair shall be correctly associated with one specific set of domain parameters. [...]  The domain parameters shall be protected from unauthorized modification until the set is deactivated. [...] The same domain parameters may be used for more than one purpose. [...] However, using different domain parameters reduces the risk that key pairs generated for one purpose could be accidentally used for another purpose." If you don't want to make mistakes, don't allow yourself to. Domain parameters are the EC paramters.\n
A Kpub's duration of use is greater than the Kpriv's duration of use.\n
ECDSA keys should only be used to sign and verify.\n
The security strength of the hash function must be equal or greater than the strength of ECDSA. The strength should be the same.\n
#### EdDSA
Quote: "See SP 800-186 for details on curves approved for use with EdDSA.".\n
Prehash EdDSA seems more interesting than EdDSA. If I am not mistaken, professor ABBAS recommended this.
EdDSA is deterministic. Ross Anderson said that randomness is always beneficial in cryptography. But it may be better in environments with insufficient randomness.\n
Quote: "For Ed25519, SHA-512 shall be used. For Ed448, SHAKE256 (as specified in FIPS 202) shall be used."\n
### SP 800-57 Part1 Revision 5
#### Cryptoperiods
Kpriv-sig and auth: Quote: "a maximum cryptoperiod of about one to three years is recommended."\n
    Kpub-sig-ver and auth: several years. One should consider that, with time, a cryptosystem and a key will get more vulnerable. Signature verefication may continue so long as the Kpriv was used in its cryptoperiod.\n
    Symmetric authentication keys: for sensitive information, one may use one key per information. The originator may use it for a maximum of two years. The recipient may use it to verify for a maximum of three years after the key's no longer in use.\n
    Symmetric encryption: if the key is used to encrypt large voluments of data, it's period should be short, a day to a week. If it encrypts less data over time, it may be longer, up to two years. The recipient should use it for no longer than three years after the period. For keys that are used to encrypt a single emssage or a session, the data may be kept until the data is encrypted nuder a new key, or is destroyed.\n
    Assymetric key-wrapping keys: If the key is used to devlier a lot of keys, it should last for one day to a week. Otherwise, it can be used up to two years.\n
    Symmetric master key: may be one year.\n
#### Compromise countermeasures
Don't leave it in plaintext; set access controls; use of physically protected containers, such as HSM; use integrity checks; ensure that the proper key is established; log access to keys; provide a cryptographic integrity check mechanism, such as MACs and dig signatures; use trusted timestamps; destroy keys after period; create a compromise-recovery plan.\n
Design the system so that the compromsie of one key will have as little damage as possible.\
The recovery plan should include:
    1.  An identification of the personnel to notify and what the notification should contain.\
    2.  An identification of the personnel to perform the recovery actions;\
    3.  The method for obtaining a new key.\
    4.  An inventory of all cryptographic keys.\
    5.  OpSec.\
    6.  An identification of all personnel needed to support the compromise-recovery procedures;\
    7.  Request key revocation;\
    8.  Monitor re-keying;\
    9.  additions...\
#### Key length
RSA : 3072-bit key is estimated be acceptable beyond 2031\
ECDSA and ECHD: 256-383 is also estimated.\
DH: Kpub of 3072-bit and Kpriv of 256. estimated.\
AES: 128. estimated\
\n
As for Hash functions: SHA-256, SHA-512/256, and SHA3-256. I consider SHA3 to be better because it is not built on top of MD5. For HMAC, SHA-1 and KMAC128. estimated. I dislike SHA1, go for SHA3-224.\n
#### Cipher Suits Security
The strength of a cipher suit is also tied to the key generation process.\n
Refer to the previous Key Length section.
#### Considering the future
This is but an estimate.\n
Go for 128 bit sec strength to be acceptable beyond 2031.\n
Be flexible, and plan well for the future.
Quote: "Typically, an organization selects the cryptographic services that are needed for a particular application. Then, based on the algorithm security lifetime and the security life of the data to be protected, an algorithm and key-size suite that are sufficient to meet the requirements are selected. The organization then establishes a key-management system, including validated cryptographic products that provide the services required by the application. As an algorithm and/or key-size suite nears the end of its security lifetime, transitioning to a new algorithm and key-size suite should be planned."\n
Talking about the future, quote: "In addition, the recovered plaintext could be used to attempt a matched plaintext-ciphertext attack on the new algorithm.\n
You should consider the protection lifetime of your data. If the algorithm security lifetime of an encryption algorithm ends on December 31, 2030, then data with a security life of four years should not be encrypted using that algorithm after December 31, 2026.\n
Quote: "The process of transitioning to a new algorithm or key size may be as simple as selecting a more secure option in the security suites offered by the current system, or it can be as complex as building an entirely new system."\n
Quote: "The lessons to be learned are that an encryption mechanism used for information that will be available to unauthorized entities in its encrypted form (e.g., via transmission) should provide a high level of security protection, and the use of each key should be limited (i.e., the cryptoperiod should be short) so that a compromised key cannot be used to reveal very much information. If the algorithm itself is broken, 75 an adversary is forced to perform more work to decrypt all of the information when each key is used to encrypt a very limited amount of information."\n
#### Key protection
IT is always better to use an HSM of FIPS 140 level 4. Level 3 is unacceptable unless fortified.\n
You should backup your keys for availability.
#### Pre-operational phase of a key
The key's owner needs to deal with a registration authority to register himsefl in the system. The CA's strength (or weakness) of a security infrastructure will often depend upon the identification process. FIPS 201 and SP 800-63 address requirements for establishing identity.\n 
With this section, I will surely revise my PKIX project. Insha'Allah.\n
The CA must have a secure system for operations. It must consider algorithm preferences, the identification of trusted parties, and the definition of domain-parameter policies and any trusted parameters  (e.g., recognized certificate policies).\n
The entity needs to set up its keys and comply with the CA's preferences.\n
The distribution of the public key shall provide assurance to the receiver that:\n
    1. The purpose/usage of the key is known;\n
    2. Any parameters associated with the public key are known;\n
    3. The public key is valid; and\n
    4. The owner actually possesses the corresponding private key.\n
The CA's public key must be authenticated.\n
Trust-anchor certificates are often embedded within an application and distributed with the application. The entity relies upon the authenticity of the software distribution mechanism to ensure that only valid trust-anchor certificates are installed during installation or replacement.\n
Quote: "The (reputed) owner should provide POP by performing operations with the private key that satisfy the indicated key use.", it still can be done by signing the CSR. In that case, if the key is not inteded to sign, it should not be used to sign.
The public key and information can be supplied some secure ways, some of them are:
    1. In person.
    2. The owner's identity is established, and their authorization is verified in person, and a secret value is supplied by the CA to the owner to finish theoperation. The value should be destroyed right away.
    They stated that a lifetime of twenty four hours.
    3. If an owner wants a recertification, he must sign the new request using his old Kpriv that was used to sign the old CSR delivered to this CA. He must assure the CA of the Kpub validty and that he possesses the corresponding private key.
    4. The CA may received the information, along with the claimed owner's identity and authorization. It then delegates the verification. It then sends the secret value in a secure manner. If the owner confirms that the trusted process secceeded, the certificate is delivered, and the key is destroyed.
    5. The Kpub and DNS addresses are supplied via network in a CSR. The CA confirms that the subject is authorized to request a cert for that DNS by performing a challenge via DNS record for the addresses, a challenge via HTTP to the DNS addresses, or in some other way.
As for central distribution, the server must protect the private keys, and the recipient must be authenticated. Similarly, the owner must obtain assurance of key validity and authenticity.
#### Operational Phase
When recovering the key, you must determine (1) its type; (2) the application it was used in; (3) whether it's yours or another's; (4) the role of the owner in a communication; and (5) its algorithm and the related operation information.
#### Post operational phase
If you de-register an entity, don't use its identifier again to avoid confusion.\
Regarding symm key compromise, use a Compromised Key List CKL. and a CRL or OCSP with asymm.
#### Additional considerations
You must control access to key material. By means of 2FA or digital signatures. See SP 800-63, SP 800-
130, and SP 800-152 for more.
